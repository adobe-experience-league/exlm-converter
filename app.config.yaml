application:
  hooks:
    pre-app-build: npm run build
  runtimeManifest:
    packages:
      main:
        license: Apache-2.0
        actions:
          convert:
            function: dist/converter # this is a folder that is built by the pre-app-build hook. needs to be a folder to serve static fragment files
            web: 'yes'
            runtime: 'nodejs:18'
            limits:
              memory: 1024
              concurrency: 2
            inputs:
              LOG_LEVEL: debug
              aemAuthorUrl: $AEM_AUTHOR_URL
              aemOwner: $OWNER
              aemRepo: $REPO
              aemBranch: $BRANCH
              exlApiHost: $EXL_API_HOST
              featureFlags: $FEATURE_FLAGS
              v2Paths: $V2_PATHS
            annotations:
              require-adobe-auth: false # explicitly unauthenticated action
              final: true
          khoros:
            function: dist/khoros # this is a folder that is built by the pre-app-build hook. needs to be a folder to serve static fragment files
            web: 'yes'
            runtime: 'nodejs:18'
            inputs:
              LOG_LEVEL: debug
              khorosApiSecret: $KHOROS_API_SECRET
              khorosOrigin: $KHOROS_ORIGIN
              imsOrigin: $IMS_ORIGIN
              imsClientId: $IMS_CLIENT_ID
              imsClientSecret: $IMS_CLIENT_SECRET
              imsAuthorizationCode: $IMS_AUTHORIZATION_CODE
              ipassApiKey: $IPASS_API_KEY
              gainsightApiUrl: $GAINSIGHT_API_URL
              gainsightOAuth2ClientId: $GAINSIGHT_OAUTH2_CLIENT_ID
              gainsightOAuth2ClientSecret: $GAINSIGHT_OAUTH2_CLIENT_SECRET
              gainsightOAuth2Scope: $GAINSIGHT_OAUTH2_SCOPE
              gainsightCommunityUrl: $GAINSIGHT_COMMUNITY_URL
            annotations:
              require-adobe-auth: false # explicitly unauthenticated action
              final: true
          tocs:
            function: dist/tocs # this is a folder that is built by the pre-app-build hook. needs to be a folder to serve static fragment files
            web: 'yes'
            runtime: 'nodejs:18'
            inputs:
              LOG_LEVEL: debug
            annotations:
              require-adobe-auth: false # explicitly unauthenticated action
              final: true
          files:
            function: dist/files # this is a folder that is built by the pre-app-build hook. needs to be a folder to serve static fragment files
            web: 'yes'
            runtime: 'nodejs:18'
            inputs:
              LOG_LEVEL: debug
            annotations:
              require-adobe-auth: false # explicitly unauthenticated action
              final: true
          publish:
            function: dist/publish # this is a folder that is built by the pre-app-build hook. needs to be a folder to serve static fragment files
            web: 'no'
            runtime: 'nodejs:18'
            inputs:
              LOG_LEVEL: debug
              owner: $OWNER
              repo: $REPO
              branch: $BRANCH
              apiKey: $HLX_API_KEY
            annotations:
              final: true
          coveo-token:
            function: dist/coveo
            web: 'yes'
            runtime: 'nodejs:18'
            inputs:
              LOG_LEVEL: debug
              # Vault configuration
              vaultEndpoint: $VAULT_ENDPOINT
              vaultRoleId: $VAULT_ROLE_ID
              vaultSecretId: $VAULT_SECRET_ID
              vaultTokenCacheTtlSeconds: $VAULT_TOKEN_CACHE_TTL_SECONDS
              coveoSecretPath: $COVEO_SECRET_PATH
              coveoSecretKeyProd: $COVEO_SECRET_KEY_PROD
              coveoSecretKeyNonprod: $COVEO_SECRET_KEY_NONPROD
              # Optional: Explicit environment override (normally auto-detected)
              coveoEnv: $COVEO_ENV
            annotations:
              require-adobe-auth: false # unauthenticated, secured by origin validation
              final: true
              web-export: true # enable CORS for browser requests
              web-custom-options: true
